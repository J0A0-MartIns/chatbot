<div class="page-container">
    <div class="page-content">
        <h2>Base de Conhecimento</h2>
        <!-- Botão para abrir o modal de criação -->
        <button (click)="abrirModalParaCriar()" class="add-button">Adicionar Conteúdo</button>

        <!-- Barra de busca -->
        <div class="filtros-container">
            <input
                    type="text"
                    [(ngModel)]="termoBusca"
                    placeholder="Buscar por título do documento..."
                    class="input-busca"
                    name="busca"
            />
        </div>

        <!-- Tabela de Documentos -->
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Título</th>
                    <th>Subtema</th>
                    <th>Conteúdo (Prévia)</th>
                    <th>Palavras-chave</th>
                    <th>Ativo</th>
                    <th>Ações</th>
                </tr>
                </thead>
                <tbody>
                <!-- Loop para exibir cada documento filtrado -->
                <tr *ngFor="let doc of docsFiltrados(); let i = index">
                    <td>{{ doc.titulo }}</td>
                    <td>{{ doc.Subtema?.nome || 'N/A' }}</td>
                    <td>{{ doc.conteudo.substring(0, 50) + (doc.conteudo.length > 50 ? '...' : '') }}</td>
                    <td>{{ doc.palavras_chave }}</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" [checked]="doc.ativo" (change)="toggleAtivo(doc)">
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td class="action-menu-container">
                        <div class="dropdown-container">
                            <button class="icon-button" (click)="toggleActionMenu(i)">
                                ⋮
                            </button>
                            <!-- Menu de Ações -->
                            <div class="dropdown-menu" *ngIf="activeMenuIndex === i">
                                <button (click)="abrirModalParaEditar(doc)">Editar</button>
                                <button (click)="excluirDocumento(doc.id_documento)">Excluir</button>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Modal para Adicionar/Editar Documento -->
        <div class="modal" *ngIf="showModal">
            <div class="modal-content">
                <span class="close" (click)="fecharModal()">&times;</span>
                <!-- CORREÇÃO: Usa a variável 'isEditMode' para o título -->
                <h3>{{ isEditMode ? 'Editar Documento' : 'Adicionar Documento' }}</h3>

                <!-- CORREÇÃO: Formulário agora usa 'docEmEdicao' -->
                <form (ngSubmit)="salvarDocumento()">
                    <input type="text" [(ngModel)]="docEmEdicao.titulo" name="titulo" placeholder="Título do Documento" required/>

                    <!-- NOTA: O ideal aqui seria um <select> para escolher o subtema -->
                    <input type="number" [(ngModel)]="docEmEdicao.id_subtema" name="id_subtema" placeholder="ID do Subtema" required/>

                    <textarea [(ngModel)]="docEmEdicao.conteudo" name="conteudo" placeholder="Conteúdo do documento..." required></textarea>

                    <!-- CORREÇÃO: Campo único para palavras-chave -->
                    <input type="text" [(ngModel)]="docEmEdicao.palavras_chave" name="palavras_chave" placeholder="Palavras-chave (separadas por vírgula)"/>

                    <!-- Seção de upload de arquivos foi removida por enquanto para simplificar e alinhar com o back-end -->

                    <div class="modal-buttons">
                        <button type="submit" [disabled]="!docEmEdicao.titulo || !docEmEdicao.conteudo">
                            {{ isEditMode ? 'Atualizar' : 'Adicionar' }}
                        </button>
                        <button type="button" *ngIf="isEditMode" (click)="fecharModal()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
